# Project History

- **Release Preparation (v0.1.0):**
    - Codebase fully scanned and linted: `cargo clippy` clean.
    - Test suite validated: `cargo test` passing (including smoke tests).
    - Version bumped to `0.1.0` (removed -alpha suffix).
    - Fixed `[target]` configuration warning in `Cargo.toml`.
- **Documentation Overhaul Refinement:**
    - Removed all persona names (Alex, Jamie, Sam) from `README.md`, `BUYERS_GUIDE.md`, `personas.md`, `roadmap.md`, and `src/selftest/mod.rs`.
    - Replaced personas with strictly functional use cases: **Simple Troubleshooting**, **Reliability & Uptime**, **High Performance**.
    - Simplified "Simple Troubleshooting" profile in `personas.md` and `README.md` to be more inclusive (removed "Home Server Energy" and "proud of home server" references).
    - Updated `BUYERS_GUIDE.md` to clarify that 10GbE (Option B) is a future Phase 14 item and not currently supported in the codebase.
- **Roadmap Updates (`roadmap.md`):**
    - Added **Dual-radio simultaneous capture** to Phase 13 (Advanced Diagnostics).
    - Added **PoE+ presence detection** and **UPS monitoring** to Phase 2.3 (Hardware Self-Test).
    - Added **UPS graceful shutdown** to Phase 13.
    - **Strategic Pivot:** Moved 2.5GbE support from Phase 6 to Phase 14 (Future High-Performance) to focus Phase 6 entirely on optimizing 1GbE throughput and reliability. Updated `BUYERS_GUIDE.md` and `README.md` to reflect this "1GbE First" strategy while keeping 2.5GbE/10GbE as future-proofing options.
- **Code Maintenance:**
    - Updated `src/selftest/mod.rs` to use new Use Case strings for compatibility reporting.
    - Fixed `clippy::manual_flatten` lint in `src/analysis/aggregator.rs`.
    - Added `# Safety` documentation to `unsafe` functions in `src/accel/vulkan.rs` and `src/accel/gles.rs` to satisfy strict CI requirements.
    - Ran `cargo clean` and verified clean build state.

## 2026-02-12 (v0.1.0 Pro Release)
- **Deployment & Pi 5 Optimization:**
    - Deployed to specific Pi 5 target (`alfa@PacketParamedic.alpina`).
    - Enabled `cortex-a76` specific compiler optimizations in `.cargo/config.toml`.
    - Tuned SQLite for SD/NVMe usage (WAL, mmap, memory temp store).
    - Verified NEON SIMD backend active and optimized.
- **Features Completed:**
    - **Throughput High-Performance Phase (Phase 6):**
        - Implemented `iperf3` wrapper in `src/throughput/mod.rs` replacing stub.
        - Supported both LAN (peer-to-peer) and WAN (public server fallback) modes.
        - Integrated JSON parsing for structured results.
    - **Scheduling Engine (Phase 6.5):**
        - Fixed cron expression parsing to support standard 5-field syntax (auto-normalization to Quartz 6-field).
        - Verified CRUD operations and persistence via integration tests.
- **Quality Assurance:**
    - Created comprehensive `TESTING.md` with Appliance Validation Checklist (Installation, Hardware, Throughput, Security, Data Integrity, Wi-Fi).
    - Implemented and ran `tests/validate_deployment.py` against live appliance.
    - Verified 100% pass rate for Health, Self-Test, Network, Schedule, and CLI smoke tests.
    - Updated `README.md` and `ROADMAP.md` to prominently feature hardware strategy and limits.
    - Updated `BUYERS_GUIDE.md` to mandate Active Cooling for all Pi 5 use cases (no passive options).
- **Phase 6 & 6.5 Max Optimization:**
    - **Security:** Hardened `iperf3` execution with input sanitization (`validate_target`).
    - **Scalability:** Implemented CPU pinning (`taskset -c 2,3`) for throughput tests to isolate load from API/Scheduler cores (0,1).
    - **Concurrency Control:** Added `Semaphore`-based bandwidth coordination to prevent overlapping heavy tests.
    - **Defaults:** Wired up `profiles::defaults()` to ensure standard schedule set on startup.
- **Backend Feature Completion (Provider Framework & Trace):**
    - **Throughput Providers (Phase 6):**
        - Implemented `SpeedTestProvider` trait framework.
        - Supported **Ookla Speedtest** (Recommended, strict EULA note), **NDT7** (Open/Diagnostic), **Fast.com** (Streaming).
    - **Path Analysis (Phase 7):**
        - Implemented `mtr` wrapper (`src/probes/trace.rs`) for hop-by-hop latency and loss analysis.
        - Added `trace_results` table to persistent schema.
    - **Verification & Simulation:**
        - Created `tests/persona_simulation.rs` validating 3 personas: **Simple Troubleshooting**, **Reliability Soak**, **High Performance**.
        - Simulated hardware utilization (CPU isolation/Thermal) on Pi 5 target (`docs/SIMULATION_REPORT.md` delivered).
        - Successfully executed live `mtr` trace against public DNS.
        - **Refactoring:** Upgraded persona tests to "Full FAT" dynamic discovery (`get_all_providers`) to automatically detect and test Ookla, NDT7, and Fast.com installations.

## 2026-02-09
- Initialized development session.
- Verified repository structure and initial scaffolding.
- Created `SECURITY.md` outlining project security posture.
- Updated `roadmap.md` to mark Phase 0 items as complete:
    - Repo scaffolding created.
    - Versioning scheme defined.
    - Security posture documented.
    - Pi 5 hardware requirements documented.
- **Phase 1 Progress:**
    - Designed systemd unit layout (checked existing files).
    - Set up reproducible build pipeline via `tools/Dockerfile.build` and `tools/build-container.sh` (produces `.deb`).
- **Phase 3 Planning:**
    - Documented "Overuse" architecture in `docs/ACCELERATION_STRATEGY.md`.
    - Updated `roadmap.md` with detailed tasks for Vulkan 1.2, OpenGL ES 3, and NEON backends.
    - **Update:** Phase 3 marked as **MANDATORY**.
- **Phase 1 Progress:**
    - Verified `src/storage/mod.rs` (WAL mode enabled).
    - Updated `src/storage/schema.rs` with `measurements`, `spool`, and `acceleration_logs` support (columns `backend`, `duration_us`).
    - Implemented `src/storage/spool.rs` for crash-safe metric buffering.
    - Added `src/system/ntp.rs` (timedatectl wrapper) and `src/system/disk.rs` (simple df wrapper).
    - Added `systemd/journald.conf.d/packetparamedic-retention.conf` for 1GB/7d log retention.
    - Verified build passes `cargo check`.
    - **Note:** Phase 1.1 and 1.2 logic complete. Acceptance testing (soak) pending physical hardware.
- **Phase 2 Progress (Hardware Self-Test):**
    - Implemented board detection (Pi 5 model, RAM check) in `src/selftest/hardware.rs`.
    - Implemented CPU feature check (NEON/ASIMD).
    - Implemented GPU detection (VideoCore VII / v3d presence).
    - Implemented Storage detection (NVMe vs SD).
    - Implemented Thermal/Power check (vcgencmd wrapper) in `src/selftest/thermal.rs`.
    - Implemented Network Interface scan (10GbE / PCIe detection) in `src/selftest/network.rs`.
    - Wired everything into `selftest::run()` and exposed via CLI (`packetparamedic self-test`).
    - **Wi-Fi Progress (Phase 2.2):**
        - Implemented `src/selftest/wifi.rs` to parse `iw list` output.
        - Detects monitor/AP/managed modes and warns if hardware lacks monitor support.
- **Phase 4.3 Progress (Blame Classifier):**
    - Created `tools/blame-trainer` (Go) to generate synthetic "ISP vs Router vs Wi-Fi" patterns.
    - Trained Logistic Regression model (Softmax) achieving 100% on synthetic verification set.
    - Implemented `src/analysis/model.rs` inference engine in Rust.
    - Embedded `blame_lr.json` as a default model with fallback to filesystem override.
    - Verified inference correctness via unit tests (`test_prediction_isp_failure`).
    - Implemented `FeatureAggregator` (`src/analysis/aggregator.rs`) to compute classifier inputs from SQLite `measurements`.
- **Phase 5 Progress (Core Probes):**
    - Implemented `IcmpProbe` (`src/probes/icmp.rs`) using system `ping` wrapper (MVP).
    - Implemented `HttpProbe` (`src/probes/http.rs`) using `reqwest` for availability/latency.
    - Implemented `DnsProbe` (`src/probes/dns.rs`) using `trust-dns-resolver`.
    - Implemented `TcpProbe` (`src/probes/tcp.rs`) using `tokio::net::TcpStream`.
- **Phase 6.5 Progress (Scheduling):**
    - Upgraded storage to use `r2d2` connection pooling (`src/storage/mod.rs`).
    - Implemented persistent scheduler with `cron` crate and SQLite `schedules` table.
    - Implemented execution loop (`src/scheduler/engine.rs`) to spawn probe tasks.
    - Updated `packetparamedic serve` to run scheduler in background.
- **Phase 4.1 Progress (Data Layer):**
    - Designed `probes_results`, `incidents`, `throughput_results`, `measurements`, `spool`, `schedules`, `schedule_history` tables.
    - Added `blame_predictions` table to store classifier outputs (verdict, confidence using JSON blobs).
    - Implemented idempotent SQLite migrations in `src/storage/schema.rs`.
    - **Phase 3 Progress (Acceleration) - COMPLETED:**
        - Fully implemented `AccelerationManager` (`src/accel/manager.rs`) with runtime backend detection (Vulkan/GLES/NEON).
        - Defined `AcceleratedOp` trait (`src/accel/ops.rs`) enforcing implementation for all 3 backends + scalar fallback.
        - **NEON Backend:** Implemented highly optimized `neon_cpu` path for statistical operations using `std::arch::aarch64` SIMD intrinsics. Verified parity with scalar reference.
        - **OpenGL ES 3 Backend:** Implemented `gles3_computeish` path (`src/accel/gles.rs`) using `glow`/`glutin` for headless EGL context management.
        - **Vulkan Backend:** Implemented `vk_compute` path (`src/accel/vulkan.rs`) using `ash` (Vulkan 1.2 bindings) for instance/device creation and command buffer management.
        - **Integration:** Wired `StatsOp` to attempt execution on GPU backends first, falling back to NEON, then Scalar. Verification harness in place.
- **Scope Change:**
    - Reprioritized throughput targets: 250Mbps/500Mbps/1Gbps/2.5Gbps now.
    - Deferred 5GbE/10GbE to Phase 14 (Future).
    - Updated `roadmap.md` Phases 2, 6, and 14 to reflect this focus.
