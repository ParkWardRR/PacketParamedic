# Project History

## 2026-02-09
- Initialized development session.
- Verified repository structure and initial scaffolding.
- Created `SECURITY.md` outlining project security posture.
- Updated `roadmap.md` to mark Phase 0 items as complete:
    - Repo scaffolding created.
    - Versioning scheme defined.
    - Security posture documented.
    - Pi 5 hardware requirements documented.
- **Phase 1 Progress:**
    - Designed systemd unit layout (checked existing files).
    - Set up reproducible build pipeline via `tools/Dockerfile.build` and `tools/build-container.sh` (produces `.deb`).
- **Phase 3 Planning:**
    - Documented "Overuse" architecture in `docs/ACCELERATION_STRATEGY.md`.
    - Updated `roadmap.md` with detailed tasks for Vulkan 1.2, OpenGL ES 3, and NEON backends.
    - **Update:** Phase 3 marked as **MANDATORY**.
- **Phase 1 Progress:**
    - Verified `src/storage/mod.rs` (WAL mode enabled).
    - Updated `src/storage/schema.rs` with `measurements`, `spool`, and `acceleration_logs` support (columns `backend`, `duration_us`).
    - Implemented `src/storage/spool.rs` for crash-safe metric buffering.
    - Added `src/system/ntp.rs` (timedatectl wrapper) and `src/system/disk.rs` (simple df wrapper).
    - Added `systemd/journald.conf.d/packetparamedic-retention.conf` for 1GB/7d log retention.
    - Verified build passes `cargo check`.
    - **Note:** Phase 1.1 and 1.2 logic complete. Acceptance testing (soak) pending physical hardware.
- **Phase 2 Progress (Hardware Self-Test):**
    - Implemented board detection (Pi 5 model, RAM check) in `src/selftest/hardware.rs`.
    - Implemented CPU feature check (NEON/ASIMD).
    - Implemented GPU detection (VideoCore VII / v3d presence).
    - Implemented Storage detection (NVMe vs SD).
    - Implemented Thermal/Power check (vcgencmd wrapper) in `src/selftest/thermal.rs`.
    - Implemented Network Interface scan (10GbE / PCIe detection) in `src/selftest/network.rs`.
    - Wired everything into `selftest::run()` and exposed via CLI (`packetparamedic self-test`).
    - **Wi-Fi Progress (Phase 2.2):**
        - Implemented `src/selftest/wifi.rs` to parse `iw list` output.
        - Detects monitor/AP/managed modes and warns if hardware lacks monitor support.
- **Phase 4.3 Progress (Blame Classifier):**
    - Created `tools/blame-trainer` (Go) to generate synthetic "ISP vs Router vs Wi-Fi" patterns.
    - Trained Logistic Regression model (Softmax) achieving 100% on synthetic verification set.
    - Implemented `src/analysis/model.rs` inference engine in Rust.
    - Embedded `blame_lr.json` as a default model with fallback to filesystem override.
    - Verified inference correctness via unit tests (`test_prediction_isp_failure`).
    - Implemented `FeatureAggregator` (`src/analysis/aggregator.rs`) to compute classifier inputs from SQLite `measurements`.
- **Phase 5 Progress (Core Probes):**
    - Implemented `IcmpProbe` (`src/probes/icmp.rs`) using system `ping` wrapper (MVP).
    - Implemented `HttpProbe` (`src/probes/http.rs`) using `reqwest` for availability/latency.
    - Implemented `DnsProbe` (`src/probes/dns.rs`) using `trust-dns-resolver`.
    - Implemented `TcpProbe` (`src/probes/tcp.rs`) using `tokio::net::TcpStream`.
- **Phase 6.5 Progress (Scheduling):**
    - Upgraded storage to use `r2d2` connection pooling (`src/storage/mod.rs`).
    - Implemented persistent scheduler with `cron` crate and SQLite `schedules` table.
    - Implemented execution loop (`src/scheduler/engine.rs`) to spawn probe tasks.
    - Updated `packetparamedic serve` to run scheduler in background.
- **Phase 4.1 Progress (Data Layer):**
    - Designed `probes_results`, `incidents`, `throughput_results`, `measurements`, `spool`, `schedules`, `schedule_history` tables.
    - Added `blame_predictions` table to store classifier outputs (verdict, confidence using JSON blobs).
    - Implemented idempotent SQLite migrations in `src/storage/schema.rs`.
    - **Phase 3 Progress (Acceleration) - COMPLETED:**
        - Fully implemented `AccelerationManager` (`src/accel/manager.rs`) with runtime backend detection (Vulkan/GLES/NEON).
        - Defined `AcceleratedOp` trait (`src/accel/ops.rs`) enforcing implementation for all 3 backends + scalar fallback.
        - **NEON Backend:** Implemented highly optimized `neon_cpu` path for statistical operations using `std::arch::aarch64` SIMD intrinsics. Verified parity with scalar reference.
        - **OpenGL ES 3 Backend:** Implemented `gles3_computeish` path (`src/accel/gles.rs`) using `glow`/`glutin` for headless EGL context management.
        - **Vulkan Backend:** Implemented `vk_compute` path (`src/accel/vulkan.rs`) using `ash` (Vulkan 1.2 bindings) for instance/device creation and command buffer management.
        - **Integration:** Wired `StatsOp` to attempt execution on GPU backends first, falling back to NEON, then Scalar. Verification harness in place.
- **Scope Change:**
    - Reprioritized throughput targets: 250Mbps/500Mbps/1Gbps/2.5Gbps now.
    - Deferred 5GbE/10GbE to Phase 14 (Future).
    - Updated `roadmap.md` Phases 2, 6, and 14 to reflect this focus.
